<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Face Emotion Detector</title>

  <style>
    :root {
      --card-bg: #ffffff;
      --accent: #6a0befff;
      --danger: rgba(61, 24, 73, 1);
    }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #f2f6ff, #fff);
      margin: 0;
      padding: 24px;
      color: #111;
    }
    .container {
      max-width: 760px;
      margin: 18px auto;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 6px 22px rgba(20,40,80,0.08);
      padding: 18px;
    }
    h1 { margin: 0 0 12px 0; font-size: 20px; }
    p.lead { margin-top: 4px; color: var(--muted); font-size: 13px; }
    form { display: grid; grid-template-columns: 1fr 320px; gap: 14px; align-items: start; }
    .left { padding-right: 6px; }
    .field { margin-bottom: 10px; }
    label { display: block; font-size: 13px; margin-bottom: 6px; font-weight: 600; }
    input[type="text"], input[type="email"], textarea, select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e4e7ef;
      border-radius: 8px;
      font-size: 14px;
      box-sizing: border-box;
    }
    textarea { min-height: 86px; resize: vertical; }
    input[type="file"] { font-size: 13px; }
    .note { font-size: 12px; color: var(--muted); margin-top: 8px; }
    .preview-card {
      border: 1px dashed #e6eefc;
      border-radius: 8px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      background: linear-gradient(180deg, #fbfdff, #fff);
    }
    .preview-img {
      width: 280px;
      height: 280px;
      display: block;
      object-fit: cover;
      border-radius: 8px;
      background: #f6f8ff;
      border: 1px solid #eef4ff;
    }
    .result {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-weight: 700;
    }
    .result.success { background: #e9f7ef; color: #127a3b; border: 1px solid #d1f0d7; }
    .result.warn { background: #fff7e6; color: #7a5a00; border: 1px solid #ffedd0; }
    .actions { margin-top: 8px; display: flex; gap: 8px; }
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
    }
    button.secondary {
      background: transparent;
      border: 1px solid #e4e7ef;
      color: #222;
      font-weight: 600;
    }
    footer { margin-top: 14px; font-size: 12px; color: var(--muted); text-align: center; }
    @media (max-width:900px){
      form{ grid-template-columns: 1fr; }
      .preview-img{ width:100%; height:220px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Face Emotion Detector</h1>
    <p class="lead">Hello! Fill in your details, upload a clear headshot, and we'll tell your mood based off science.</p>

    <form id="uploadForm" method="post" action="/predict" enctype="multipart/form-data" novalidate>
      <div class="left">
        <div class="field">
          <label for="full_name">Full name</label>
          <input id="full_name" name="full_name" type="text" placeholder="Jane Doe" required>
        </div>

        <div class="field">
          <label for="student_id">Student ID</label>
          <input id="student_id" name="student_id" type="text" placeholder="e.g. CS12345" required>
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="you@school.edu" required>
        </div>

        <div class="field">
          <label for="course">Course / Class</label>
          <input id="course" name="course" type="text" placeholder="Computer Science" required>
        </div>

        <div class="field">
          <label for="notes">Notes (optional)</label>
          <textarea id="notes" name="notes" placeholder="Any context for the photo?"></textarea>
        </div>

        <div class="field">
          <label for="image">Upload photo</label>
          <input id="image" name="image" type="file" accept="image/*" required>
          <div class="note">Use a clear, frontal headshot with good lighting.</div>
        </div>

        <div class="actions">
          <button type="submit">Detect emotion</button>
          <button type="button" class="secondary" id="clearBtn">Clear</button>
        </div>
      </div>

      <aside class="preview-card">
        <div style="width:100%; text-align:left;">
          <strong>Preview</strong>
          <div class="note" style="margin-top:4px;">Your mood will appear here!</div>
        </div>

        <!-- Image preview -->
        {% if uploaded_image %}
          <img id="previewImage" class="preview-img" src="{{ url_for('static', filename=uploaded_image) }}" alt="Uploaded Image">
        {% else %}
          <img id="previewImage" class="preview-img" alt="Image preview (none)" src="data:image/svg+xml;utf8,
          <svg xmlns='http://www.w3.org/2000/svg' width='280' height='280'><rect width='100%' height='100%' fill='%23f6f8ff'/><text x='50%' y='50%' alignment-baseline='middle' text-anchor='middle' fill='%23b6c8ee' font-size='18'>No image selected</text></svg>"/>
        {% endif %}

        {% if display_message %}
          <div id="serverResult" class="result success" role="status">
            {{ display_message }}
            {% if emotion %}
              <div style="font-size:14px; margin-top:6px;">Prediction: {{ emotion }}</div>
            {% endif %}
          </div>
        {% endif %}
      </aside>
    </form>

    <footer>
      Built for learning. This model is experimental â€” treat results like friendly guesses, not therapy!
    </footer>
  </div>

  <script>
    (function(){
      const input = document.getElementById('image');
      const preview = document.getElementById('previewImage');
      const clearBtn = document.getElementById('clearBtn');
      const serverResult = document.getElementById('serverResult');

      input.addEventListener('change', function(e){
        const file = e.target.files && e.target.files[0];
        if(!file) return;
        if (!file.type.startsWith('image/')) {
          alert('Please choose an image file.');
          input.value = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = function(ev){ preview.src = ev.target.result; };
        reader.readAsDataURL(file);
        if (serverResult) serverResult.style.display = 'none';
      });

      clearBtn.addEventListener('click', function(){
        document.getElementById('uploadForm').reset();
        preview.src = preview.getAttribute('data-default') || preview.src;
        if (serverResult) serverResult.style.display = 'none';
      });
    })();
  </script>
</body>
</html>
